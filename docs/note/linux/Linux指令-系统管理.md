# Linux指令-系统管理

## 1. 常用的系统管理命令

### 1.1 echo

命令描述：用于字符串的输出。

命令格式：`echo [字符串 | $变量]`

```bash
1.定义临时变量，并显示到终端
export name="daning"
echo $name

2.输出字符串至文件中。若文件存在，则内容覆盖；若不存在，则创建。其中>符号表示输出重定向
echo "Hello World" > test.txt

3.若需将内容追加至文件，而不是覆盖，可使用>>符号，该符号表示输出追加重定向
echo "Hello World" >> test.txt

4.显示命令执行结果
echo `pwd` 或 echo $(pwd)
```

### 1.2 date

命令描述：用于显示或设置系统的时间与日期。

命令格式：`date [参数] [+格式]`

格式说明（以2022年1月1日为例）：

| 格式 | 说明                                                       |
| ---- | ---------------------------------------------------------- |
| %a   | 星期名缩写（Sat）                                          |
| %A   | 星期名全称（Saturday）                                     |
| %b   | 月名缩写（Jan）                                            |
| %B   | 月名全称（January）                                        |
| %c   | 日期和时间（Sat 01 Jan 2022 12:53:36 PM CST）              |
| %C   | 年份的前两位（20）                                         |
| %d   | 日（例如：01）                                             |
| %D   | 日期，等价于%m/%d/%y（01/01/22）                           |
| %F   | 日期，等价于 %Y-%m-%d（2022-01-01）                        |
| %j   | 一年中的第几天（001）                                      |
| %p   | 上午下午（PM）                                             |
| %r   | 12 小时时钟时间（12:58:09 PM）                             |
| %R   | 24 小时的时和分，等价于%H:%M（12:59）                      |
| %s   | 自UTC时间1970-01-01 00:00:00以来所经过的秒数（1641013169） |
| %T   | 时间，等价于%H:%M:%S（12:59:54）                           |
| %U   | 一年中的第几周，以周日为每星期第一天（00）                 |
| %x   | 本地日期描述（01/01/2022）                                 |
| %X   | 本地时间描述（01:01:13 PM）                                |
| %w   | 一周中的第几天，0 代表周一（6）                            |
| %W   | 一年中的第几周，以周一为每星期第一天（00）                 |

```bash
1.以默认格式查看当前系统时间
date

2.以指定格式查看当前系统时间
date "+%Y-%m-%d %H:%M:%S"

3.查看当前时间是一年中的第几天
date "+%j"

4.将系统时间设置为2020年02月20日20点20分20秒
date -s "20200220 20:20:20"

5.校正系统时间，与网络时间同步
a.安装ntp校时工具：yum -y install ntp
b.用ntpdate从时间服务器更新时间：ntpdate time.nist.gov
```

### 1.3 wget

命令描述：wget是一个从网络上自动下载文件的自由工具。

命令格式：`wget [参数] 下载地址`

参数说明：

| 参数 | 说明                                 |
| ---- | ------------------------------------ |
| -b   | 后台下载                             |
| -P   | 下载到指定目录                       |
| -t   | 最大重试次数                         |
| -c   | 断点续传                             |
| -p   | 下载页面内所有资源，包括图片、视频等 |
| -r   | 递归下载                             |

```bash
1.下载一张图片到路径/root/static/img/中，-p参数默认值为当前路径，如果指定路径不存在，将自动创建
wget -P /root/static/img/ http://img.alicdn.com/tfs/TB1.R._t7L0gK0jSZFxXXXWHVXa-2666-1500.png
```

### 1.4 ps（process status）

命令描述：用于显示系统中的进程状态。

命令格式：`ps [参数]`

命令参数说明：

| 参数 | 说明                                               |
| ---- | -------------------------------------------------- |
| -a   | 显示现行终端机下的所有程序，包括其他用户的程序     |
| -u   | 以用户为主的格式来显示程序状况                     |
| -x   | 显示没有控制终端的进程，同时显示各个命令的具体路径 |
| -e   | 列出程序时，显示每个程序所使用的环境变量           |
| -f   | 显示当前所有的进程                                 |
| -t   | 指定终端机编号，并列出属于该终端机的程序的状况     |

```bash
ps -ef | grep sshd
```

### 1.5 top

命令描述：用于实时显示进程活动与系统负载等信息。

```bash
top
```

命令输出参数说明：

- 将命令输出视图分为两个区域，统计信息区、进程信息区

- 统计信息区
  - 第一行信息依次为：系统时间、运行时间、登录终端数、系统负载（三个数值分别为1分钟、5分钟、15分钟内的平均值，数值越小意味着负载越低）。
  - 第二行信息依次为：进程总数、运行中的进程数、睡眠中的进程数、停止的进程数、僵死的进程数。
  - 第三行信息依次为：用户占用资源百分比、系统内核占用资源百分比、改变过优先级的进程资源百分比、空闲的资源百分比等。
  - 第四行信息依次为：物理内存总量、内存使用量、内存空闲量、作为内核缓存的内存量。
  - 第五行信息依次为：虚拟内存总量、虚拟内存使用量、虚拟内存空闲量、预加载内存量。
- 进程信息区

| 列名    | 含义                                                         |
| ------- | ------------------------------------------------------------ |
| PID     | 进程ID                                                       |
| USER    | 进程所有者的用户名                                           |
| PR      | 进程优先级                                                   |
| NI      | nice值，负值表示高优先级，正值表示低优先级                   |
| VIRT    | 进程使用的虚拟内存总量，单位kb                               |
| RES     | 进程使用的、未被换出的物理内存大小，单位kb                   |
| SHR     | 共享内存大小，单位kb                                         |
| S       | 进程状态D：不可中断的睡眠状态R：正在运行S：睡眠T：停止Z：僵尸进程 |
| %CPU    | 上次更新到现在的CPU时间占用百分比                            |
| %MEM    | 进程使用的物理内存百分比                                     |
| TIME+   | 进程使用的CPU时间总计，单位1/100秒                           |
| COMMAND | 命令名                                                       |

按`q`键退出监控页面

### 1.6 pidof

命令描述：用于查找指定服务进程名称的PID值。

命令格式：`pidof [服务进程名称]`

命令参数说明：

| 参数 | 说明                                                   |
| ---- | ------------------------------------------------------ |
| -s   | 仅返回一个进程号                                       |
| -c   | 只显示运行在root目录下的进程，这个选项只对root用户有效 |
| -o   | 忽略指定进程号的进程                                   |
| -x   | 显示由脚本开启的进程                                   |

```bash
1.查询出crond服务下的所有进程ID
pidof crond
```

### 1.7 kill

命令描述：kill命令用于终止指定PID的服务进程。

kill可将指定的信息送至程序。预设的信息为SIGTERM(15)，可将指定程序终止。若仍无法终止该程序，可使用SIGKILL(9)信息尝试强制删除程序。

命令格式：`kill [参数] [进程PID]`

```bash
1.删除pid为1000的进程
kill -9 1000
```

### 1.8 killall

命令描述：killall命令用于终止指定名称的服务对应的全部进程。

命令格式：`killall [进程名称]`

```bash
1.删除crond服务下的所有进程
killall crond
```

## 2. 系统状态检测命令

### 2.1 ifconfig

命令描述：用于显示网卡配置与网络状态等信息。

- 获取网卡配置与网络状态等信息

```bash
ifconfig
```

命令输出说明：

- 第一部分的第一行显示网卡状态信息
  - eth0表示第一块网卡
  - UP代表网卡开启状态
  - RUNNING代表网卡的网线被接上
  - MULTICAST表示支持组播
- 第二行显示网卡的网络信息
  - inet（IP地址）：172.16.132.195
  - broadcast（广播地址）：172.16.143.255
  - netmask（掩码地址）：255.255.240.0
- RX表示接收数据包的情况，TX表示发送数据包的情况
- lo表示主机的回环网卡，是一种特殊的网络接口，不与任何实际设备连接，而是完全由软件实现。与回环地址（127.0.0.0/8 或 ::1/128）不同，回环网卡对系统显示为一块硬件。任何发送到该网卡上的数据都将立刻被同一网卡接收到。

### 2.2 uname（unix name）

命令描述：用于查看系统内核与系统版本等信息。

命令语法：`uname [-amnrsv] [--help] [--version]`

命令参数说明：

| 参数      | 说明                   |
| --------- | ---------------------- |
| -a        | 显示系统的全部信息     |
| -m        | 显示计算机类型         |
| -n        | 显示主机名称           |
| -r        | 显示操作系统的发行编号 |
| -s        | 显示操作系统名称       |
| -v        | 显示操作系统的版本     |
| --help    | 显示帮助               |
| --version | 显示版本信息           |

- 显示系统信息

```bash
uname -a
```

- 显示当前系统的硬件架构

```bash
uname -i
```

- 显示操作系统的发行编号

```bash
uname -r
```

- 显示操作系统名称

```bash
uname -s
```

- 显示主机名称

```bash
uname -n
```

### 2.3 uptime

命令描述：显示系统已经运行了多长时间，它依次显示下列信息：当前时间、系统已经运行了多长时间、有多少登陆用户、系统在过去的1分钟、5分钟和15分钟内的平均负载。

命令语法：`uptime`

### 2.4 free

命令描述：用于显示当前系统中内存的使用情况。

命令语法：`free [-bkmotV] [-s <间隔秒数>]`

命令参数说明：

| 参数 | 说明                                                         |
| ---- | ------------------------------------------------------------ |
| -b   | 以Byte为单位显示内存使用情况                                 |
| -k   | 以KB为单位显示内存使用情况                                   |
| -m   | 以MB为单位显示内存使用情况                                   |
| -h   | 以合适的单位显示内存使用情况，最大为三位数，自动计算对应的单位值 |

- 显示当前系统中内存的使用量信息

```bash
free -h
```

命令输出说明：

| 参数       | 说明                                          |
| ---------- | --------------------------------------------- |
| total      | 物理内存总数                                  |
| used       | 已经使用的内存数                              |
| free       | 空间的内存数                                  |
| share      | 多个进程共享的内存总额                        |
| buff/cache | 应用使用内存数                                |
| available  | 可用的内存数                                  |
| Swap       | 虚拟内存（阿里云ECS服务器默认不开启虚拟内存） |

### 2.5 who

命令描述：用于显示当前系统中的所有使用者相关信息。

- 显示当前登录系统的用户

```bash
who
```

- 显示用户登录来源

```bash
who -l -H
```

- 只显示当前用户

```bash
who -m -H
```

- 精简模式显示

```bash
who -q
```

### 2.6 last

命令描述： 用于显示用户最近登录信息。

- 显示用户最近登录信息

```bash
last
```

> 注意：由于这些信息都是以日志文件的形式保存在系统中，黑客可以轻易的对内容进行篡改，所以该命令输出的信息并不能作为服务器是否被入侵的依据。

### 2.7 history

命令描述：用于显示历史执行过的命令。

> bash默认记录1000条执行过的历史命令，被记录在~/.bash_history文件中。

- 显示最新10条执行过的命令

```bash
history 10
```

- 清除历史记录

```bash
history -c
```

